---
- name: Install PostgreSQL {{ pg_version }} Modules
  apt:
    name: "{{ packages }}"
    state: present
    update_cache: no
    install_recommends: yes
  vars:
    packages:
      - postgresql-contrib-{{ pg_version }}
  notify: restart postgresql
  tags: pg-extensions

- name: Adds 'pg_stat_statements' extension to all databases
  become: true
  become_user: "{{ pg_user }}"
  postgresql_ext:
    name: pg_stat_statements
    db: "{{ item.key }}"
    cascade: true
  with_dict: "{{ credentials.users }}"
  tags: pg-extensions
